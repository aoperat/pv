# 🔧 배포 사이트 환경변수 오류 해결 가이드

## 🚨 현재 문제

배포된 사이트(`https://aoperat.github.io/pv/`)에서 다음과 같은 오류가 발생:
```
⚠️ Supabase 환경변수가 설정되지 않았습니다.
TypeError: Failed to fetch
```

**원인:** GitHub Actions 빌드 시 환경변수가 제대로 전달되지 않았습니다.

---

## ✅ 해결 방법 (단계별)

### 1단계: GitHub Secrets 확인 및 설정

1. **GitHub 저장소로 이동**
   - https://github.com/aoperat/pv

2. **Settings > Secrets and variables > Actions** 클릭
   - 또는 직접: https://github.com/aoperat/pv/settings/secrets/actions

3. **Secrets 목록 확인**
   - 다음 두 개가 **반드시** 있어야 합니다:
     - `VITE_SUPABASE_URL`
     - `VITE_SUPABASE_ANON_KEY`

4. **없다면 추가하기:**
   - "New repository secret" 클릭
   - Name: `VITE_SUPABASE_URL`
   - Secret: `.env.local` 파일의 `VITE_SUPABASE_URL` 값 복사
   - Add secret
   - 다시 "New repository secret" 클릭
   - Name: `VITE_SUPABASE_ANON_KEY`
   - Secret: `.env.local` 파일의 `VITE_SUPABASE_ANON_KEY` 값 복사
   - Add secret

### 2단계: 빌드 로그 확인

1. **Actions 탭으로 이동**
   - https://github.com/aoperat/pv/actions

2. **최근 워크플로우 실행 클릭**
   - "Deploy to GitHub Pages" 워크플로우

3. **"Build" 단계 클릭하여 로그 확인**
   - 환경변수가 제대로 전달되었는지 확인
   - 빌드 에러가 있는지 확인

### 3단계: 재배포

Secrets를 설정하거나 수정한 후에는 **반드시 재배포**해야 합니다.

#### 방법 1: 자동 재배포 (권장)
```bash
# 빈 커밋으로 재배포 트리거
git commit --allow-empty -m "Trigger rebuild with updated secrets"
git push origin main
```

#### 방법 2: 수동 재배포
1. GitHub 저장소 > Actions 탭
2. "Deploy to GitHub Pages" 워크플로우 클릭
3. 오른쪽 상단 "Run workflow" 버튼 클릭
4. "Run workflow" 확인

### 4단계: 배포 확인

1. **Actions 탭에서 빌드 완료 대기**
   - 초록색 체크 표시가 나올 때까지 대기 (1-2분)

2. **배포된 사이트 접속**
   - https://aoperat.github.io/pv/
   - 브라우저 개발자 도구 콘솔 확인
   - 환경변수 오류가 사라졌는지 확인

---

## 🔍 Secrets 설정 확인 체크리스트

- [ ] `VITE_SUPABASE_URL` Secret이 존재함
- [ ] `VITE_SUPABASE_ANON_KEY` Secret이 존재함
- [ ] Secret 값이 `.env.local`의 값과 일치함
- [ ] Secret 이름이 정확함 (대소문자 주의!)
- [ ] 재배포를 실행했음

---

## 📋 Secrets 값 확인 방법

로컬에서 `.env.local` 파일 확인:
```bash
# Windows
type .env.local

# 또는 에디터로 열기
notepad .env.local
```

확인해야 할 값:
```
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**중요:** 
- URL은 `https://`로 시작해야 함
- Key는 `eyJ...`로 시작하는 긴 문자열

---

## 🛠️ 빌드 테스트 (로컬)

배포 전 로컬에서 빌드 테스트:

```bash
# 빌드 실행
npm run build

# 빌드 결과 미리보기
npm run preview
```

브라우저 콘솔에서 환경변수 오류가 없는지 확인하세요.

---

## ⚠️ 주의사항

1. **Secret 이름 정확성**
   - `VITE_SUPABASE_URL` (정확히 이 이름이어야 함)
   - `VITE_SUPABASE_ANON_KEY` (정확히 이 이름이어야 함)
   - 대소문자, 언더스코어 모두 정확해야 합니다!

2. **재배포 필요**
   - Secrets를 수정한 후에는 반드시 재배포해야 합니다
   - 빌드는 Secrets 값을 사용하므로, Secrets 변경 후 새로 빌드해야 합니다

3. **빌드 로그 확인**
   - Actions 탭에서 빌드 로그를 확인하여 환경변수가 전달되었는지 확인
   - 빌드가 성공했어도 환경변수가 없으면 배포된 사이트에서 오류 발생

---

## 🆘 여전히 문제가 있나요?

1. **Secrets가 올바르게 설정되었는지 재확인**
2. **빌드 로그에서 에러 메시지 확인**
3. **로컬에서 `npm run build` 테스트**
4. **브라우저 캐시 삭제 후 재접속** (Ctrl + Shift + R)

문제가 계속되면 Actions 탭의 빌드 로그를 공유해주시면 더 구체적으로 도와드릴 수 있습니다.

